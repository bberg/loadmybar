<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RY7R4MB2F1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RY7R4MB2F1');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>LoadMyBar - Barbell Plate Calculator | Free Weight Loading Tool</title>
    <meta name="description" content="Free barbell plate calculator. Instantly see which plates to load for any weight. Works offline, supports lb/kg, includes warmup calculator, 5/3/1 program, and gym inventory manager.">
    <meta name="keywords" content="plate calculator, barbell calculator, weight calculator, gym calculator, olympic lifting, powerlifting, 5/3/1, warmup sets">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LoadMyBar">
    <link rel="manifest" href="manifest.json">
    <link rel="canonical" href="https://loadmybar.com/">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="styles/shared.css">

    <!-- Open Graph / Social -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="LoadMyBar - Barbell Plate Calculator">
    <meta property="og:description" content="Instantly see which plates to load for any weight. Free, works offline, no signup.">
    <meta property="og:url" content="https://loadmybar.com/">
    <meta property="og:site_name" content="LoadMyBar">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="LoadMyBar - Barbell Plate Calculator">
    <meta name="twitter:description" content="Instantly see which plates to load for any weight.">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "LoadMyBar",
      "description": "Free barbell plate calculator. Instantly see which plates to load for any weight.",
      "url": "https://loadmybar.com",
      "applicationCategory": "SportsApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Plate calculator for any weight",
        "Warmup set generator",
        "5/3/1 program calculator",
        "Gym plate inventory manager",
        "1RM calculator",
        "Works offline",
        "No signup required"
      ]
    }
    </script>

    <style>
        /* Page-specific styles - Mobile first, compact layout */

        /* Hero section - minimal on mobile */
        .hero-section {
            padding: var(--space-2) 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .hero-title {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            text-align: center;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            display: none;
        }

        @media (min-width: 768px) {
            .hero-section {
                padding: var(--space-5) 0;
                flex-direction: column;
                gap: var(--space-1);
            }
            .hero-title {
                font-size: var(--text-2xl);
            }
            .hero-subtitle {
                display: block;
                text-align: center;
                color: var(--text-secondary);
                font-size: var(--text-sm);
            }
        }

        /* Main weight display - prominent but compact on mobile */
        .weight-display-section {
            text-align: center;
            padding: var(--space-2) 0;
            margin-bottom: var(--space-2);
        }

        @media (min-width: 768px) {
            .weight-display-section {
                padding: var(--space-4) 0;
                margin-bottom: var(--space-4);
            }
        }

        .weight-display {
            font-size: 3.25rem;
            font-weight: var(--font-bold);
            color: var(--text-primary);
            line-height: 1;
            font-variant-numeric: tabular-nums;
            transition: transform 0.1s ease, color 0.2s ease, text-shadow 0.2s ease;
            letter-spacing: -0.02em;
        }

        .weight-display.bump {
            transform: scale(1.03);
            color: var(--accent-blue);
            text-shadow: 0 0 30px rgba(96, 165, 250, 0.5);
        }

        .weight-unit-label {
            font-size: var(--text-base);
            color: var(--text-muted);
            margin-left: var(--space-1);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        @media (min-width: 768px) {
            .weight-display {
                font-size: 4.5rem;
            }
            .weight-unit-label {
                font-size: var(--text-lg);
                margin-left: var(--space-2);
            }
        }

        /* Stepper controls - compact grid on mobile */
        .stepper-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        @media (min-width: 768px) {
            .stepper-controls {
                display: flex;
                justify-content: center;
                gap: var(--space-3);
                margin-top: var(--space-4);
            }
        }

        .stepper-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 44px;
            font-size: var(--text-sm);
            font-weight: var(--font-bold);
            background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
            -webkit-user-select: none;
        }

        @media (min-width: 768px) {
            .stepper-btn {
                width: 72px;
                height: 48px;
                font-size: var(--text-base);
            }
        }

        .stepper-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-blue);
            transform: translateY(-1px);
        }

        .stepper-btn:active {
            transform: scale(0.95);
            background: linear-gradient(145deg, var(--accent-blue), var(--accent-blue-muted));
            border-color: var(--accent-blue);
            color: var(--text-on-emphasis);
        }

        /* Settings row - stacked on mobile */
        .settings-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        @media (min-width: 768px) {
            .settings-row {
                display: flex;
                gap: var(--space-3);
                margin-bottom: var(--space-4);
            }
            .setting-item {
                flex: 1;
                min-width: 160px;
            }
        }

        .setting-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: var(--space-1);
        }

        @media (min-width: 768px) {
            .setting-label {
                font-size: var(--text-xs);
                margin-bottom: var(--space-2);
            }
        }

        .unit-toggle {
            display: flex;
            background: var(--bg-primary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .unit-btn {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-xs);
            font-weight: var(--font-bold);
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all var(--transition-fast);
            letter-spacing: 0.03em;
        }

        @media (min-width: 768px) {
            .unit-btn {
                padding: var(--space-3) var(--space-4);
                font-size: var(--text-sm);
            }
        }

        .unit-btn.active {
            background: linear-gradient(145deg, var(--accent-green), var(--accent-green-emphasis));
            color: var(--text-on-emphasis);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        .unit-btn:not(.active):hover {
            background: var(--bg-glass-light);
            color: var(--text-primary);
        }

        /* Bar weight selector */
        .bar-select {
            width: 100%;
            min-height: 40px;
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            background: var(--bg-primary);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 16px;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            padding-right: 32px;
        }

        @media (min-width: 768px) {
            .bar-select {
                min-height: var(--touch-target-min);
                padding: var(--space-3) var(--space-4);
                font-size: var(--text-base);
                background-position: right 12px center;
                background-size: 20px;
                padding-right: 44px;
            }
        }

        .bar-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px var(--accent-blue-glow);
        }

        /* Hidden number input for direct entry */
        .weight-input-hidden {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        /* Quick weight buttons - scrollable row on mobile */
        .quick-weights {
            display: flex;
            gap: var(--space-2);
            justify-content: flex-start;
            margin-top: var(--space-3);
            padding-top: var(--space-3);
            border-top: 1px solid var(--border-muted);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding-bottom: var(--space-1);
        }

        .quick-weights::-webkit-scrollbar {
            display: none;
        }

        @media (min-width: 768px) {
            .quick-weights {
                flex-wrap: wrap;
                justify-content: center;
                overflow-x: visible;
                margin-top: var(--space-4);
                padding-top: var(--space-4);
            }
        }

        .quick-weight-btn {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            background: var(--bg-glass-light);
            border: 1px solid var(--border-muted);
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .quick-weight-btn {
                padding: var(--space-2) var(--space-4);
                font-size: var(--text-sm);
            }
        }

        .quick-weight-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .quick-weight-btn:active, .quick-weight-btn.active {
            background: linear-gradient(145deg, var(--accent-blue), var(--accent-blue-muted));
            border-color: var(--accent-blue);
            color: var(--text-on-emphasis);
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        /* Features section */
        .features-section {
            margin-top: var(--space-5);
            padding-top: var(--space-4);
            border-top: 1px solid var(--border-muted);
        }

        @media (min-width: 768px) {
            .features-section {
                margin-top: var(--space-6);
                padding-top: var(--space-5);
            }
        }

        .features-title {
            text-align: center;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: var(--space-3);
        }

        @media (min-width: 768px) {
            .features-title {
                font-size: var(--text-xs);
                margin-bottom: var(--space-4);
            }
        }

        /* Plate animation on load */
        .plate {
            animation: plateLoad 0.2s ease-out backwards;
        }

        @keyframes plateLoad {
            from {
                opacity: 0;
                transform: translateX(-6px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .plates-side.right .plate {
            animation-name: plateLoadRight;
        }

        @keyframes plateLoadRight {
            from {
                opacity: 0;
                transform: translateX(6px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        /* Keyboard hint - desktop only */
        .keyboard-hint {
            text-align: center;
            font-size: var(--text-xs);
            color: var(--text-muted);
            margin-top: var(--space-3);
            display: none;
        }

        @media (min-width: 768px) {
            .keyboard-hint {
                display: block;
            }
        }

        .keyboard-hint kbd {
            display: inline-block;
            padding: 2px 6px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            margin: 0 2px;
        }

        /* Tap hint for mobile */
        .tap-hint {
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        @media (min-width: 768px) {
            .tap-hint {
                display: none;
            }
        }
    </style>
</head>
<body class="has-bottom-nav">
    <div class="container">
        <!-- Hero Section -->
        <section class="hero-section">
            <h1 class="hero-title">LoadMyBar</h1>
            <p class="hero-subtitle">Instantly see which plates to load</p>
        </section>

        <!-- Main Calculator Card -->
        <main class="card card-elevated">
            <!-- Big Weight Display -->
            <div class="weight-display-section">
                <span class="weight-display" id="weightDisplay" role="status" aria-live="polite">135</span>
                <span class="weight-unit-label" id="unitLabel">LB</span>
                <input
                    type="number"
                    id="targetWeight"
                    class="weight-input-hidden"
                    value="135"
                    min="0"
                    step="5"
                    inputmode="decimal"
                    autocomplete="off"
                    aria-label="Target weight"
                    tabindex="-1"
                >
            </div>

            <!-- Stepper Controls -->
            <div class="stepper-controls">
                <button class="stepper-btn" data-step="-45" aria-label="Subtract 45">−45</button>
                <button class="stepper-btn" data-step="-5" aria-label="Subtract 5">−5</button>
                <button class="stepper-btn" data-step="5" aria-label="Add 5">+5</button>
                <button class="stepper-btn" data-step="45" aria-label="Add 45">+45</button>
            </div>

            <p class="tap-hint">Tap the weight to type directly</p>
            <p class="keyboard-hint">Use <kbd>↑</kbd> <kbd>↓</kbd> arrows or type directly</p>

            <!-- Quick Weight Buttons -->
            <div class="quick-weights" id="quickWeights" aria-label="Quick weight presets"></div>

            <!-- Settings Row -->
            <div class="settings-row">
                <div class="setting-item">
                    <div class="setting-label">Unit</div>
                    <div class="unit-toggle" role="group" aria-label="Unit selection">
                        <button class="unit-btn active" data-unit="lb" aria-pressed="true">LB</button>
                        <button class="unit-btn" data-unit="kg" aria-pressed="false">KG</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-label">Bar</div>
                    <select id="barWeight" class="bar-select" aria-label="Select bar type">
                        <option value="45">Olympic - 45 lb</option>
                        <option value="35">Women's - 35 lb</option>
                        <option value="33">Technique - 33 lb</option>
                        <option value="15">Training - 15 lb</option>
                        <option value="0">No Bar</option>
                    </select>
                </div>
            </div>

            <!-- Barbell Visualization -->
            <div class="barbell-container" aria-hidden="true">
                <div class="barbell">
                    <div class="plates-side left" id="platesLeft"></div>
                    <div class="bar">
                        <div class="sleeve left"></div>
                        <div class="sleeve right"></div>
                    </div>
                    <div class="plates-side right" id="platesRight"></div>
                </div>
            </div>

            <!-- Results -->
            <div id="results" class="results-section" role="region" aria-live="polite" aria-label="Plate calculation results"></div>
        </main>

        <!-- Features Section -->
        <section class="features-section">
            <h2 class="features-title">More Tools</h2>
            <div class="feature-grid">
                <a href="warmup.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
                    </svg>
                    <h3 class="feature-title">Warmup Sets</h3>
                    <p class="feature-description">Generate progressive warmup sets</p>
                </a>
                <a href="531.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    <h3 class="feature-title">5/3/1 Program</h3>
                    <p class="feature-description">Wendler program with plates</p>
                </a>
                <a href="tools/one-rep-max.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20V10"/>
                        <path d="M18 20V4"/>
                        <path d="M6 20v-4"/>
                    </svg>
                    <h3 class="feature-title">1RM Calculator</h3>
                    <p class="feature-description">Estimate your one rep max</p>
                </a>
            </div>
        </section>

        <!-- Guides Section -->
        <section class="features-section" style="border-top:none;padding-top:0;margin-top:var(--space-4);">
            <h2 class="features-title">Guides & Reference</h2>
            <div class="feature-grid">
                <a href="reference/common-weights.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 11H4a2 2 0 00-2 2v6a2 2 0 002 2h5"/>
                        <path d="M15 11h5a2 2 0 012 2v6a2 2 0 01-2 2h-5"/>
                        <rect x="9" y="3" width="6" height="18" rx="1"/>
                    </svg>
                    <h3 class="feature-title">Common Weights</h3>
                    <p class="feature-description">Quick plate reference chart</p>
                </a>
                <a href="guides/plate-colors.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <h3 class="feature-title">Plate Colors</h3>
                    <p class="feature-description">Olympic plate color guide</p>
                </a>
                <a href="guides/barbell-types.html" class="feature-card">
                    <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="10" width="20" height="4" rx="1"/>
                        <circle cx="5" cy="12" r="3"/>
                        <circle cx="19" cy="12" r="3"/>
                    </svg>
                    <h3 class="feature-title">Barbell Types</h3>
                    <p class="feature-description">Bar weights & specs guide</p>
                </a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>LoadMyBar - Free tools for lifters. No signup. No tracking.</p>
            <p style="margin-top:var(--space-2)"><a href="inventory.html">My Plates</a></p>
        </footer>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-bottom" aria-label="Main navigation">
        <a href="index.html" class="nav-item active" aria-current="page">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="9"/>
                <rect x="14" y="3" width="7" height="5"/>
                <rect x="14" y="12" width="7" height="9"/>
                <rect x="3" y="16" width="7" height="5"/>
            </svg>
            <span>Calculator</span>
        </a>
        <a href="warmup.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
            </svg>
            <span>Warmup</span>
        </a>
        <a href="531.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
            <span>5/3/1</span>
        </a>
        <a href="inventory.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            <span>My Plates</span>
        </a>
    </nav>

    <script>
        // ===================================================================
        // Plate Calculator Logic
        // ===================================================================

        // Plate configurations by unit
        const PLATES = {
            lb: [
                { weight: 55, className: 'plate-55', color: '#dc2626', label: '55' },
                { weight: 45, className: 'plate-45', color: '#2563eb', label: '45' },
                { weight: 35, className: 'plate-35', color: '#eab308', label: '35' },
                { weight: 25, className: 'plate-25', color: '#16a34a', label: '25' },
                { weight: 10, className: 'plate-10', color: '#f5f5f5', label: '10' },
                { weight: 5, className: 'plate-5', color: '#dc2626', label: '5' },
                { weight: 2.5, className: 'plate-2-5', color: '#16a34a', label: '2.5' },
                { weight: 1.25, className: 'plate-1-25', color: '#6b7280', label: '1.25' }
            ],
            kg: [
                { weight: 25, className: 'plate-25kg', color: '#dc2626', label: '25' },
                { weight: 20, className: 'plate-20kg', color: '#2563eb', label: '20' },
                { weight: 15, className: 'plate-15kg', color: '#eab308', label: '15' },
                { weight: 10, className: 'plate-10kg', color: '#16a34a', label: '10' },
                { weight: 5, className: 'plate-5kg', color: '#f5f5f5', label: '5' },
                { weight: 2.5, className: 'plate-2-5kg', color: '#dc2626', label: '2.5' },
                { weight: 1.25, className: 'plate-1-25kg', color: '#16a34a', label: '1.25' }
            ]
        };

        const BAR_WEIGHTS = {
            lb: [
                { value: 45, label: 'Olympic Bar - 45 lb' },
                { value: 35, label: "Women's Olympic - 35 lb" },
                { value: 33, label: 'Technique Bar - 33 lb' },
                { value: 15, label: 'Training Bar - 15 lb' },
                { value: 0, label: 'No Bar (plates only)' }
            ],
            kg: [
                { value: 20, label: 'Olympic Bar - 20 kg' },
                { value: 15, label: "Women's Olympic - 15 kg" },
                { value: 10, label: 'Technique Bar - 10 kg' },
                { value: 7, label: 'Training Bar - 7 kg' },
                { value: 0, label: 'No Bar (plates only)' }
            ]
        };

        const QUICK_WEIGHTS = {
            lb: [95, 135, 185, 225, 275, 315, 405],
            kg: [40, 60, 80, 100, 120, 140, 180]
        };

        // State
        let currentUnit = 'lb';

        // DOM Elements
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => document.querySelectorAll(sel);

        const targetWeightInput = $('#targetWeight');
        const weightDisplay = $('#weightDisplay');
        const unitLabelDisplay = $('#unitLabel');
        const barWeightSelect = $('#barWeight');
        const platesLeft = $('#platesLeft');
        const platesRight = $('#platesRight');
        const resultsDiv = $('#results');
        const unitBtns = $$('.unit-btn');
        const quickWeightsDiv = $('#quickWeights');
        const stepperBtns = $$('.stepper-btn');

        // Calculate plates needed per side
        function calculatePlates(targetWeight, barWeight, unit) {
            const plates = PLATES[unit];
            const weightPerSide = (targetWeight - barWeight) / 2;

            if (weightPerSide < 0) {
                return {
                    error: `Target must be at least ${barWeight} ${unit.toUpperCase()} (bar weight)`
                };
            }

            const result = [];
            let remaining = weightPerSide;

            for (const plate of plates) {
                const count = Math.floor(remaining / plate.weight);
                if (count > 0) {
                    result.push({ ...plate, count });
                    remaining = Math.round((remaining - count * plate.weight) * 100) / 100;
                }
            }

            if (remaining > 0.01) {
                const achievableWeight = targetWeight - remaining * 2;
                return {
                    plates: result,
                    warning: `Closest weight: ${achievableWeight.toFixed(2)} ${unit.toUpperCase()}`,
                    actualWeight: achievableWeight
                };
            }

            return { plates: result, actualWeight: targetWeight };
        }

        // Render plate elements for visualization
        function renderPlates(plateData) {
            if (!plateData.plates) return '';

            let html = '';
            let delay = 0;

            for (const plate of plateData.plates) {
                for (let i = 0; i < plate.count; i++) {
                    html += `<div class="plate ${plate.className}" style="animation-delay: ${delay}ms">${plate.label}</div>`;
                    delay += 50;
                }
            }
            return html;
        }

        // Render results list
        function renderResults(plateData, barWeight, unit) {
            const unitLabel = unit.toUpperCase();

            if (plateData.error) {
                return `<div class="message message-error">${plateData.error}</div>`;
            }

            if (!plateData.plates || plateData.plates.length === 0) {
                const target = parseFloat(targetWeightInput.value);
                if (barWeight === target) {
                    return `
                        <div class="total-display">
                            <span class="total-label">Total Weight (bar only)</span>
                            <span class="total-weight">${barWeight} ${unitLabel}</span>
                        </div>
                    `;
                }
            }

            let html = '<h3 class="results-header">Plates Per Side</h3><div class="plate-list">';

            if (plateData.plates) {
                for (const plate of plateData.plates) {
                    const textColor = plate.color === '#f5f5f5' ? '#000' : '#fff';
                    html += `
                        <div class="plate-item">
                            <div class="plate-color" style="background: ${plate.color}; color: ${textColor}"></div>
                            <span class="plate-count">${plate.count}x</span>
                            <span>${plate.weight} ${unitLabel}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';

            if (plateData.warning) {
                html += `<div class="message message-warning mt-4">${plateData.warning}</div>`;
            }

            html += `
                <div class="total-display">
                    <span class="total-label">Total Weight</span>
                    <span class="total-weight">${plateData.actualWeight} ${unitLabel}</span>
                </div>
            `;

            return html;
        }

        // Update quick weight buttons
        function updateQuickWeights() {
            const weights = QUICK_WEIGHTS[currentUnit];
            const currentWeight = parseFloat(targetWeightInput.value) || 0;
            quickWeightsDiv.innerHTML = weights.map(w =>
                `<button class="quick-weight-btn ${w === currentWeight ? 'active' : ''}" data-weight="${w}">${w}</button>`
            ).join('');
        }

        // Update the big weight display
        function updateWeightDisplay(animate = false) {
            const weight = parseFloat(targetWeightInput.value) || 0;
            weightDisplay.textContent = weight;
            unitLabelDisplay.textContent = currentUnit.toUpperCase();

            if (animate) {
                weightDisplay.classList.add('bump');
                setTimeout(() => weightDisplay.classList.remove('bump'), 100);
            }
        }

        // Update stepper button labels based on unit
        function updateStepperLabels() {
            const bigStep = currentUnit === 'lb' ? 45 : 20;
            const smallStep = currentUnit === 'lb' ? 5 : 2.5;

            stepperBtns.forEach(btn => {
                const currentStep = parseFloat(btn.dataset.step);
                let newStep;
                if (Math.abs(currentStep) >= 20) {
                    newStep = currentStep > 0 ? bigStep : -bigStep;
                } else {
                    newStep = currentStep > 0 ? smallStep : -smallStep;
                }
                btn.dataset.step = newStep;
                btn.textContent = newStep > 0 ? `+${newStep}` : newStep;
            });
        }

        // Update bar options
        function updateBarOptions() {
            const options = BAR_WEIGHTS[currentUnit];
            barWeightSelect.innerHTML = options.map(opt =>
                `<option value="${opt.value}">${opt.label}</option>`
            ).join('');
        }

        // Main update function
        function update(animate = false) {
            const targetWeight = parseFloat(targetWeightInput.value) || 0;
            const barWeight = parseFloat(barWeightSelect.value) || 0;

            updateWeightDisplay(animate);
            updateQuickWeights();

            const plateData = calculatePlates(targetWeight, barWeight, currentUnit);

            const platesHtml = renderPlates(plateData);
            platesLeft.innerHTML = platesHtml;
            platesRight.innerHTML = platesHtml;

            resultsDiv.innerHTML = renderResults(plateData, barWeight, currentUnit);

            // Save state
            localStorage.setItem('plateCalc', JSON.stringify({
                targetWeight,
                barWeight,
                unit: currentUnit
            }));
        }

        // Event Listeners
        targetWeightInput.addEventListener('input', () => update(true));
        barWeightSelect.addEventListener('change', update);

        // Stepper buttons
        stepperBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const step = parseFloat(btn.dataset.step);
                const currentVal = parseFloat(targetWeightInput.value) || 0;
                const newVal = Math.max(0, currentVal + step);
                targetWeightInput.value = newVal;
                update(true);
            });
        });

        // Make weight display clickable for direct input
        weightDisplay.addEventListener('click', () => {
            const newValue = prompt('Enter weight:', targetWeightInput.value);
            if (newValue !== null && !isNaN(parseFloat(newValue))) {
                targetWeightInput.value = Math.max(0, parseFloat(newValue));
                update(true);
            }
        });
        weightDisplay.style.cursor = 'pointer';

        unitBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                unitBtns.forEach(b => {
                    b.classList.remove('active');
                    b.setAttribute('aria-pressed', 'false');
                });
                btn.classList.add('active');
                btn.setAttribute('aria-pressed', 'true');

                const newUnit = btn.dataset.unit;

                // Convert weight
                const currentWeight = parseFloat(targetWeightInput.value) || 0;
                if (newUnit === 'kg' && currentUnit === 'lb') {
                    targetWeightInput.value = Math.round(currentWeight / 2.205);
                } else if (newUnit === 'lb' && currentUnit === 'kg') {
                    targetWeightInput.value = Math.round(currentWeight * 2.205);
                }

                currentUnit = newUnit;
                updateBarOptions();
                updateStepperLabels();
                update();
            });
        });

        quickWeightsDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('quick-weight-btn')) {
                targetWeightInput.value = e.target.dataset.weight;
                update(true);
            }
        });

        // Load saved state
        function loadState() {
            const saved = localStorage.getItem('plateCalc');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    currentUnit = state.unit || 'lb';

                    unitBtns.forEach(btn => {
                        const isActive = btn.dataset.unit === currentUnit;
                        btn.classList.toggle('active', isActive);
                        btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
                    });

                    updateBarOptions();
                    updateQuickWeights();

                    targetWeightInput.value = state.targetWeight || 135;
                    barWeightSelect.value = state.barWeight || (currentUnit === 'lb' ? 45 : 20);
                } catch (e) {
                    updateQuickWeights();
                }
            } else {
                updateQuickWeights();
            }
        }

        // Initialize
        loadState();
        updateStepperLabels();
        update();

        // Global keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger if user is typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

            const bigStep = currentUnit === 'lb' ? 45 : 20;
            const smallStep = currentUnit === 'lb' ? 5 : 2.5;
            const currentVal = parseFloat(targetWeightInput.value) || 0;

            if (e.key === 'ArrowUp' || e.key === 'k') {
                e.preventDefault();
                const step = e.shiftKey ? bigStep : smallStep;
                targetWeightInput.value = currentVal + step;
                update(true);
            } else if (e.key === 'ArrowDown' || e.key === 'j') {
                e.preventDefault();
                const step = e.shiftKey ? bigStep : smallStep;
                targetWeightInput.value = Math.max(0, currentVal - step);
                update(true);
            } else if (e.key === 'u') {
                // Toggle units
                const newUnit = currentUnit === 'lb' ? 'kg' : 'lb';
                unitBtns.forEach(b => {
                    b.classList.toggle('active', b.dataset.unit === newUnit);
                    b.setAttribute('aria-pressed', b.dataset.unit === newUnit ? 'true' : 'false');
                });
                const convertedWeight = newUnit === 'kg'
                    ? Math.round(currentVal / 2.205)
                    : Math.round(currentVal * 2.205);
                targetWeightInput.value = convertedWeight;
                currentUnit = newUnit;
                updateBarOptions();
                updateStepperLabels();
                update(true);
            }
        });

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>
</body>
</html>
